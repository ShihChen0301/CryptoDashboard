# å®‰å…¨æ€§å»ºè­°èˆ‡æœ€ä½³å¯¦è¸

> **æ–‡æª”æ—¥æœŸ**ï¼š2025-12-04ï¼ˆå·²ç²¾ç°¡ï¼‰
> **é©ç”¨ç‰ˆæœ¬**ï¼šCoinVue v1.2.0+
> **å„ªå…ˆç´š**ï¼šâš ï¸âš ï¸âš ï¸ é«˜ï¼ˆç”Ÿç”¢ç’°å¢ƒéƒ¨ç½²å‰å¿…è®€ï¼‰

---

## ğŸš¨ ç«‹å³åŸ·è¡Œï¼ˆç”Ÿç”¢ç’°å¢ƒå¿…é ˆï¼‰

### 1. ç§»é™¤æ•æ„Ÿè³‡è¨Šåˆ°ç’°å¢ƒè®Šæ•¸ âš ï¸

**ç•¶å‰å•é¡Œ**ï¼š
- `application.yml` å’Œ `application-dev.yml` åŒ…å«æ˜æ–‡å¯†ç¢¼ã€å¯†é‘°
- é€™äº›æ–‡ä»¶å·²æäº¤åˆ° Gitï¼Œä»»ä½•æœ‰æ¬Šè¨ªå•å€‰åº«çš„äººéƒ½èƒ½çœ‹åˆ°

**è§£æ±ºæ­¥é©Ÿ**ï¼š

#### æ­¥é©Ÿ 1ï¼šå‰µå»ºç’°å¢ƒè®Šæ•¸æ–‡ä»¶ç¯„æœ¬

å‰µå»º `backend/.env.example`ï¼š
```bash
# Database Configuration
DB_HOST=localhost
DB_PORT=3306
DB_NAME=crypto_dashboard
DB_USERNAME=root
DB_PASSWORD=your_database_password_here

# JWT Configuration
JWT_SECRET=your_jwt_secret_key_here_minimum_64_bytes
JWT_EXPIRATION=86400000

# CoinGecko API
COINGECKO_API_KEY=your_coingecko_api_key_here

# CORS Configuration
CORS_ALLOWED_ORIGINS=http://localhost:5173,https://yourdomain.com
```

#### æ­¥é©Ÿ 2ï¼šæ›´æ–° application.yml

```yaml
spring:
  datasource:
    url: jdbc:mysql://${DB_HOST:localhost}:${DB_PORT:3306}/${DB_NAME:crypto_dashboard}?useSSL=false&serverTimezone=Asia/Taipei&characterEncoding=UTF-8&allowPublicKeyRetrieval=true
    username: ${DB_USERNAME}
    password: ${DB_PASSWORD}

jwt:
  secret: ${JWT_SECRET}
  expiration: ${JWT_EXPIRATION:86400000}

coingecko:
  api:
    key: ${COINGECKO_API_KEY}

cors:
  allowed-origins: ${CORS_ALLOWED_ORIGINS:http://localhost:5173}
```

#### æ­¥é©Ÿ 3ï¼šæ›´æ–° .gitignore

```gitignore
# Environment variables
.env
.env.local
.env.*.local

# Spring Boot
application-local.yml
application-prod.yml

# ä¿ç•™ç¯„ä¾‹æ–‡ä»¶
!.env.example
```

---

### 2. ç”Ÿæˆä¸¦æ›´æ–°å¼· JWT Secret âš ï¸

**ç•¶å‰å•é¡Œ**ï¼š
- JWT Secret å¼·åº¦ä¸è¶³ï¼ˆ< 512 ä½ï¼‰

**è§£æ±ºæ–¹æ¡ˆ**ï¼š

```bash
# ç”Ÿæˆ 512 ä½å¼·å¯†é‘°
openssl rand -base64 64
```

**é‡è¦**ï¼š
- âœ… ç”Ÿç”¢ç’°å¢ƒå¿…é ˆä½¿ç”¨ä¸åŒçš„ Secret
- âœ… å®šæœŸè¼ªæ›ï¼ˆå»ºè­°æ¯ 3-6 å€‹æœˆï¼‰
- âŒ ä¸è¦ä½¿ç”¨ç°¡å–®å­—ä¸²æˆ–å­—å…¸å–®è©

---

### 3. è®Šæ›´æ‰€æœ‰é»˜èªå¯†ç¢¼

**å¿…é ˆè®Šæ›´**ï¼š
- âœ… MySQL root å¯†ç¢¼
- âœ… æ•¸æ“šåº«ç”¨æˆ¶å¯†ç¢¼
- âœ… æ‰€æœ‰æ¸¬è©¦å¸³è™Ÿå¯†ç¢¼

**å»ºè­°**ï¼š
- ä½¿ç”¨å¯†ç¢¼ç®¡ç†å™¨ç”Ÿæˆå¼·å¯†ç¢¼
- æœ€å°‘ 16 å­—ç¬¦ï¼ŒåŒ…å«å¤§å°å¯«ã€æ•¸å­—ã€ç¬¦è™Ÿ
- å®šæœŸè®Šæ›´ï¼ˆå»ºè­°æ¯ 3 å€‹æœˆï¼‰

---

## âš™ï¸ çŸ­æœŸå„ªåŒ–ï¼ˆ1-2 é€±å…§å®Œæˆï¼‰

### 4. æ·»åŠ  Rate Limitingï¼ˆé€Ÿç‡é™åˆ¶ï¼‰

**ç›®çš„**ï¼šé˜²æ­¢æš´åŠ›ç ´è§£ã€DDoS æ”»æ“Š

**å»ºè­°çš„é™åˆ¶**ï¼š
- ç™»å…¥ APIï¼š5 æ¬¡/åˆ†é˜
- è¨»å†Š APIï¼š3 æ¬¡/å°æ™‚
- ä¸€èˆ¬ APIï¼š60 æ¬¡/åˆ†é˜

**æ¨è–¦åº«**ï¼š
- Bucket4jï¼ˆSpring Bootï¼‰
- Spring Cloud Gateway Rate Limiter

---

### 5. å¯¦ä½œéæœŸ Token è‡ªå‹•æ¸…ç†

**ç›®çš„**ï¼šé¿å…æ•¸æ“šåº«è†¨è„¹

**æ–¹æ¡ˆ Aï¼šSpring Scheduled Task**ï¼ˆæ¨è–¦ï¼‰

```java
@Scheduled(cron = "0 0 2 * * ?")  // æ¯å¤©å‡Œæ™¨ 2 é»åŸ·è¡Œ
public void cleanExpiredTokens() {
    int deleted = authTokenRepository.deleteByExpiresAtBefore(LocalDateTime.now());
    log.info("Cleaned up {} expired tokens", deleted);
}
```

**æ–¹æ¡ˆ Bï¼šMySQL Event**

```sql
CREATE EVENT IF NOT EXISTS clean_expired_tokens
ON SCHEDULE EVERY 1 DAY
STARTS (TIMESTAMP(CURRENT_DATE) + INTERVAL 1 DAY + INTERVAL 2 HOUR)
DO
  DELETE FROM auth_tokens WHERE expires_at < NOW();
```

---

### 6. å„ªåŒ–æ•¸æ“šåº«ç´¢å¼•

**åŸ·è¡Œä»¥ä¸‹ SQL**ï¼š

```sql
USE crypto_dashboard;

-- auth_tokens è¡¨ - è¤‡åˆç´¢å¼•ï¼ˆç”¨æˆ¶ + éæœŸæ™‚é–“ï¼‰
CREATE INDEX idx_user_expires
ON auth_tokens(user_id, expires_at);

-- auth_tokens è¡¨ - token ç´¢å¼•ï¼ˆåŠ é€ŸæŸ¥è©¢ï¼‰
CREATE INDEX idx_token
ON auth_tokens(token);

-- coin_favorites è¡¨ - è¤‡åˆç´¢å¼•ï¼ˆç”¨æˆ¶ + å¹£ç¨®ï¼‰
CREATE INDEX idx_user_coin
ON coin_favorites(user_id, coin_id);

-- æŸ¥çœ‹ç´¢å¼•
SHOW INDEX FROM auth_tokens;
SHOW INDEX FROM coin_favorites;
```

---

## ğŸ”’ HTTPS é…ç½®ï¼ˆç”Ÿç”¢ç’°å¢ƒå¿…é ˆï¼‰

### ä½¿ç”¨ Let's Encrypt å…è²» SSL è­‰æ›¸

```bash
# å®‰è£ Certbot
sudo apt install certbot

# ç²å–è­‰æ›¸
sudo certbot certonly --standalone -d yourdomain.com
```

### Spring Boot HTTPS é…ç½®

```yaml
# application-prod.yml
server:
  port: 8443
  ssl:
    enabled: true
    key-store: /etc/letsencrypt/live/yourdomain.com/keystore.p12
    key-store-password: ${SSL_KEYSTORE_PASSWORD}
    key-store-type: PKCS12
```

---

## ğŸ“‹ å®‰å…¨æª¢æŸ¥æ¸…å–®

### éƒ¨ç½²å‰å¿…æŸ¥

- [ ] æ‰€æœ‰æ•æ„Ÿè³‡è¨Šå·²ç§»è‡³ç’°å¢ƒè®Šæ•¸
- [ ] JWT Secret å·²æ›´æ–°ç‚ºå¼·å¯†é‘°ï¼ˆ512 ä½+ï¼‰
- [ ] æ‰€æœ‰é»˜èªå¯†ç¢¼å·²è®Šæ›´
- [ ] Rate Limiting å·²å•Ÿç”¨
- [ ] HTTPS å·²é…ç½®
- [ ] CORS å·²æ­£ç¢ºé…ç½®ï¼ˆåƒ…å…è¨±ä¿¡ä»»çš„åŸŸåï¼‰
- [ ] éæœŸ Token è‡ªå‹•æ¸…ç†å·²å•Ÿç”¨
- [ ] æ•¸æ“šåº«ç´¢å¼•å·²å„ªåŒ–

### å®šæœŸæª¢æŸ¥

- [ ] ä¾è³´å¥—ä»¶æ˜¯å¦æœ‰å®‰å…¨æ›´æ–°ï¼ˆæ¯æœˆï¼‰
- [ ] æ—¥èªŒæ˜¯å¦æœ‰ç•°å¸¸ç™»å…¥å˜—è©¦ï¼ˆæ¯é€±ï¼‰
- [ ] JWT Secret æ˜¯å¦éœ€è¦è¼ªæ›ï¼ˆæ¯ 3-6 å€‹æœˆï¼‰
- [ ] å¯†ç¢¼æ˜¯å¦éœ€è¦è®Šæ›´ï¼ˆæ¯ 3 å€‹æœˆï¼‰
- [ ] å‚™ä»½æ˜¯å¦æ­£å¸¸ï¼ˆæ¯å¤©ï¼‰

---

## ğŸ›¡ï¸ å…¶ä»–å®‰å…¨å»ºè­°

### å¯†ç¢¼ç­–ç•¥

```java
// å¼·å¯†ç¢¼é©—è­‰ç¯„ä¾‹
public boolean isStrongPassword(String password) {
    return password.length() >= 8 &&
           password.matches(".*[A-Z].*") &&  // è‡³å°‘ä¸€å€‹å¤§å¯«
           password.matches(".*[a-z].*") &&  // è‡³å°‘ä¸€å€‹å°å¯«
           password.matches(".*[0-9].*") &&  // è‡³å°‘ä¸€å€‹æ•¸å­—
           password.matches(".*[!@#$%^&*].*");  // è‡³å°‘ä¸€å€‹ç‰¹æ®Šå­—ç¬¦
}
```

### SQL Injection é˜²è­·

âœ… **ä½¿ç”¨ JPA/Hibernate**ï¼ˆå·²åšåˆ°ï¼‰
```java
// æ­£ç¢ºï¼šä½¿ç”¨åƒæ•¸åŒ–æŸ¥è©¢
@Query("SELECT u FROM User u WHERE u.email = :email")
Optional<User> findByEmail(@Param("email") String email);
```

âŒ **éŒ¯èª¤ç¤ºç¯„**
```java
// å±éšªï¼šå­—ä¸²æ‹¼æ¥
String sql = "SELECT * FROM users WHERE email = '" + email + "'";
```

### XSS é˜²è­·

å‰ç«¯è¼¸å‡ºæ™‚é€²è¡Œ HTML ç·¨ç¢¼ï¼ˆVue 3 é»˜èªå·²åšï¼‰ï¼š
```vue
<!-- å®‰å…¨ï¼šè‡ªå‹•è½‰ç¾© -->
<div>{{ userInput }}</div>

<!-- å±éšªï¼šä¸è½‰ç¾© HTML -->
<div v-html="userInput"></div>
```

---

## ğŸ“š åƒè€ƒè³‡æº

- [OWASP Top 10](https://owasp.org/www-project-top-ten/)
- [Spring Security Documentation](https://docs.spring.io/spring-security/reference/)
- [JWT Best Practices RFC 8725](https://tools.ietf.org/html/rfc8725)
- [MySQL Security Best Practices](https://dev.mysql.com/doc/refman/8.0/en/security-guidelines.html)

---

**æ–‡æª”ç‰ˆæœ¬**ï¼š2.0ï¼ˆå·²ç²¾ç°¡ï¼‰
**æœ€å¾Œæ›´æ–°**ï¼š2025-12-04
**ç¶­è­·è€…**ï¼šCoinVue é–‹ç™¼åœ˜éšŠ
