# CryptoDashboard 功能對照表

> ⚠️ **此為 v2.0 未來功能規劃文檔，尚未實作**
>
> 對照需求、資料庫、前端與 API 的實作狀態。提交幣種/審核功能已確認取消。
>
> **最後更新**：2024-11-25
> **文檔狀態**：未來功能規劃參考
> **當前專案版本**：v1.1.1（v2.0 功能尚未開始實作）

---

## 功能需求檢查與對照

| # | 功能需求 | 資料庫 | 前端介面 | 對應 API | 優先度 |
|---|---------|--------|---------|---------|-------|
| 1 | 熱門榜單數量 | 不需新增 | - | 調整 API 參數 | 低 |
| 2 | Price Chart 可拉長至 30 天 | 不需新增 | 時間範圍切換 | - | 中 |
| 3 | 使用者可自行新增幣種 | ❌ 已取消，不實作 | - | - | - |
| 4 | 同時比較多幣種（最多 4 支） | 需新增 `coin_comparisons` | 比較頁 | 需新增 | 高 |
| 5 | 使用者與管理者不同權限 | 已完成 | - | - | - |
| 6 | 管理者審核使用者新增的幣種 | ❌ 已取消，不實作 | - | - | - |
| 7 | 交易紀錄 / 持倉 | 需新增 `user_transactions` | Dashboard + 新頁 | 需新增 | 高 |
| 8 | Market Overview 資料摘要 | 不需新增 | - | 列表即可 | 低 |
| 9 | 使用者輸入交易年齡 | 已完成 | - | - | - |

---

## 資料表現況（v1→v2）

### 既有表（4 張，維持不變）
| 名稱 | 用途 |
|------|------|
| `users` | 使用者帳號 |
| `auth_tokens` | 登入 Token |
| `coin_favorites` | 收藏（Watchlist） |
| `announcements` | 系統公告 |

### 需新增表（2 張，v2.0）
| 名稱 | 用途 | 對應功能 |
|------|------|---------|
| `coin_comparisons` | 多幣比較 | 功能 4 |
| `user_transactions` | 交易紀錄/持倉 | 功能 7 |

---

## 取消功能

- 提交新幣種與管理員審核（原 `coin_submissions`）已廢案，不會在平台實作。
- 相關資料表、API、前端頁面與檔案不需開發，亦不需在部署流程中新增。

---

## 功能拆解與需求

### 功能 7：交易紀錄 / 持倉（`user_transactions`）
- **資料表**
  ```sql
  CREATE TABLE user_transactions (
      id                  BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
      user_id             BIGINT UNSIGNED NOT NULL,
      coin_id             VARCHAR(64) NOT NULL,           -- CoinGecko coin id
      transaction_type    ENUM('buy', 'sell') NOT NULL,
      amount              DECIMAL(20, 8) NOT NULL,
      price_at_time       DECIMAL(20, 8) NOT NULL,
      total_value         DECIMAL(20, 8) NOT NULL,
      fee                 DECIMAL(20, 8) DEFAULT 0,
      notes               TEXT NULL,
      transaction_date    DATETIME NOT NULL,
      created_at          DATETIME DEFAULT CURRENT_TIMESTAMP
  );
  ```
- **前端需求**
  - `PortfolioView.vue`：新增/編輯/刪除交易，列表與圖表顯示持倉。
  - `DashboardView.vue`：Trending Buys 卡片，顯示近 30 天最常被買入的前 10 個幣種。
- **API**
  - `POST /api/transactions`
  - `GET /api/transactions`
  - `GET /api/transactions/portfolio`
  - `GET /api/transactions/stats/trending-buys`
  - `DELETE /api/transactions/:id`
- **必要查詢**
  ```sql
  -- 近 30 天最常被買入的前 10 幣種
  SELECT coin_id, SUM(amount) AS total_bought
  FROM user_transactions
  WHERE transaction_type = 'buy'
    AND transaction_date > DATE_SUB(NOW(), INTERVAL 30 DAY)
  GROUP BY coin_id
  ORDER BY total_bought DESC
  LIMIT 10;
  ```

### 功能 4：多幣比較（`coin_comparisons`）
- **資料表**
  ```sql
  CREATE TABLE coin_comparisons (
      id          BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
      user_id     BIGINT UNSIGNED NOT NULL,
      name        VARCHAR(100) NOT NULL,
      coin_ids    JSON NOT NULL,              -- 最多 4 個
      created_at  DATETIME DEFAULT CURRENT_TIMESTAMP,
      updated_at  DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
      CONSTRAINT chk_coin_ids_is_array CHECK (JSON_TYPE(coin_ids) = 'ARRAY')
  );
  ```
- **前端需求**
  - `CompareView.vue`：新增/刪除比較組，顯示 4 欄並排的價格、漲跌、交易量、總市值等指標。
- **API**
  - `POST /api/comparisons`
  - `GET /api/comparisons`
  - `PUT /api/comparisons/:id`
  - `DELETE /api/comparisons/:id`

### 功能 2：Price Chart 時間範圍
- 前端：在 `PriceChart.vue`（或對應元件）加入時間範圍切換（7/30/90/180/365/Max）。
- API：使用 CoinGecko `days` 參數，不需額外資料表。

### 功能 1/8：熱門榜單與 Market Overview
- 熱門榜單：僅需調整 CoinGecko API `per_page` 參數與前端分頁 UI。
- Market Overview：列表顯示市值、24h 漲跌、成交量與供給等；不需新增資料表。

---

## 參考檔案

- 資料表：`database/schema_v2.sql`, `database/schema_v2_zh.sql`
- 需求規格：`docs/功能需求分析_v2.md`（已同步標註取消的提交幣種功能）
- 專案結構：`docs/README.md`

---

## 待辦摘要

- 交易紀錄/持倉：資料表 + API + 前端頁面。
- 多幣比較：資料表 + API + 前端頁面。
- Price Chart 時間範圍：前端時間範圍切換。
- 熱門榜單/Market Overview：前端分頁與列表優化。
- 提交幣種/審核：不實作（保持移除狀態）。

---

*最後更新：2024-11-25*
